import streamlit as st
import swisseph as swe
from datetime import datetime, time, timezone, timedelta
import os

# --- å®šæ•°ãƒ‡ãƒ¼ã‚¿ ---

# å¤©ä½“æš¦ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹
EPHE_PATH = 'ephe'
# ã‚µã‚¤ãƒ³å
SIGN_NAMES = ["ç‰¡ç¾Šåº§", "ç‰¡ç‰›åº§", "åŒå­åº§", "èŸ¹åº§", "ç…å­åº§", "ä¹™å¥³åº§", "å¤©ç§¤åº§", "è åº§", "å°„æ‰‹åº§", "å±±ç¾Šåº§", "æ°´ç“¶åº§", "é­šåº§"]
# ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆ
ELEMENTS = {'ç«': ["ç‰¡ç¾Šåº§", "ç…å­åº§", "å°„æ‰‹åº§"], 'åœ°': ["ç‰¡ç‰›åº§", "ä¹™å¥³åº§", "å±±ç¾Šåº§"], 'é¢¨': ["åŒå­åº§", "å¤©ç§¤åº§", "æ°´ç“¶åº§"], 'æ°´': ["èŸ¹åº§", "è åº§", "é­šåº§"]}
# ã‚¯ã‚ªãƒªãƒ†ã‚£
QUALITIES = {'æ´»å‹•': ["ç‰¡ç¾Šåº§", "èŸ¹åº§", "å¤©ç§¤åº§", "å±±ç¾Šåº§"], 'ä¸å‹•': ["ç‰¡ç‰›åº§", "ç…å­åº§", "è åº§", "æ°´ç“¶åº§"], 'æŸ”è»Ÿ': ["åŒå­åº§", "ä¹™å¥³åº§", "å°„æ‰‹åº§", "é­šåº§"]}
# å¤©ä½“ID
PLANET_IDS = {'å¤ªé™½': swe.SUN, 'æœˆ': swe.MOON, 'æ°´æ˜Ÿ': swe.MERCURY, 'é‡‘æ˜Ÿ': swe.VENUS, 'ç«æ˜Ÿ': swe.MARS, 'æœ¨æ˜Ÿ': swe.JUPITER, 'åœŸæ˜Ÿ': swe.SATURN, 'å¤©ç‹æ˜Ÿ': swe.URANUS, 'æµ·ç‹æ˜Ÿ': swe.NEPTUNE}

# éƒ½é“åºœçœŒã®ç·¯åº¦çµŒåº¦ãƒ‡ãƒ¼ã‚¿
PREFECTURE_DATA = {
    "åŒ—æµ·é“": {"lat": 43.064, "lon": 141.348}, "é’æ£®çœŒ": {"lat": 40.825, "lon": 140.741},
    "å²©æ‰‹çœŒ": {"lat": 39.704, "lon": 141.153}, "å®®åŸçœŒ": {"lat": 38.269, "lon": 140.872},
    "ç§‹ç”°çœŒ": {"lat": 39.719, "lon": 140.102}, "å±±å½¢çœŒ": {"lat": 38.240, "lon": 140.364},
    "ç¦å³¶çœŒ": {"lat": 37.750, "lon": 140.468}, "èŒ¨åŸçœŒ": {"lat": 36.342, "lon": 140.447},
    "æ ƒæœ¨çœŒ": {"lat": 36.566, "lon": 139.884}, "ç¾¤é¦¬çœŒ": {"lat": 36.391, "lon": 139.060},
    "åŸ¼ç‰çœŒ": {"lat": 35.857, "lon": 139.649}, "åƒè‘‰çœŒ": {"lat": 35.605, "lon": 140.123},
    "æ±äº¬éƒ½": {"lat": 35.690, "lon": 139.692}, "ç¥å¥ˆå·çœŒ": {"lat": 35.448, "lon": 139.643},
    "æ–°æ½ŸçœŒ": {"lat": 37.902, "lon": 139.023}, "å¯Œå±±çœŒ": {"lat": 36.695, "lon": 137.211},
    "çŸ³å·çœŒ": {"lat": 36.594, "lon": 136.626}, "ç¦äº•çœŒ": {"lat": 36.065, "lon": 136.222},
    "å±±æ¢¨çœŒ": {"lat": 35.664, "lon": 138.568}, "é•·é‡çœŒ": {"lat": 36.651, "lon": 138.181},
    "å²é˜œçœŒ": {"lat": 35.391, "lon": 136.722}, "é™å²¡çœŒ": {"lat": 34.977, "lon": 138.383},
    "æ„›çŸ¥çœŒ": {"lat": 35.180, "lon": 136.907}, "ä¸‰é‡çœŒ": {"lat": 34.730, "lon": 136.509},
    "æ»‹è³€çœŒ": {"lat": 35.005, "lon": 135.869}, "äº¬éƒ½åºœ": {"lat": 35.021, "lon": 135.756},
    "å¤§é˜ªåºœ": {"lat": 34.686, "lon": 135.520}, "å…µåº«çœŒ": {"lat": 34.691, "lon": 135.183},
    "å¥ˆè‰¯çœŒ": {"lat": 34.685, "lon": 135.833}, "å’Œæ­Œå±±çœŒ": {"lat": 34.226, "lon": 135.168},
    "é³¥å–çœŒ": {"lat": 35.504, "lon": 134.238}, "å³¶æ ¹çœŒ": {"lat": 35.472, "lon": 133.051},
    "å²¡å±±çœŒ": {"lat": 34.662, "lon": 133.934}, "åºƒå³¶çœŒ": {"lat": 34.396, "lon": 132.459},
    "å±±å£çœŒ": {"lat": 34.186, "lon": 131.471}, "å¾³å³¶çœŒ": {"lat": 34.066, "lon": 134.559},
    "é¦™å·çœŒ": {"lat": 34.340, "lon": 134.043}, "æ„›åª›çœŒ": {"lat": 33.842, "lon": 132.765},
    "é«˜çŸ¥çœŒ": {"lat": 33.560, "lon": 133.531}, "ç¦å²¡çœŒ": {"lat": 33.607, "lon": 130.418},
    "ä½è³€çœŒ": {"lat": 33.249, "lon": 130.299}, "é•·å´çœŒ": {"lat": 32.745, "lon": 129.874},
    "ç†Šæœ¬çœŒ": {"lat": 32.790, "lon": 130.742}, "å¤§åˆ†çœŒ": {"lat": 33.238, "lon": 131.613},
    "å®®å´çœŒ": {"lat": 31.911, "lon": 131.424}, "é¹¿å…å³¶çœŒ": {"lat": 31.560, "lon": 130.558},
    "æ²–ç¸„çœŒ": {"lat": 26.212, "lon": 127.681}
}

# â–¼â–¼â–¼ å¤‰æ›´ç‚¹1ï¼šQUESTIONSã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’å¤‰æ›´ã€‚ã€Œreasonã€ã‚’ã€Œtraitã€ã«ã€‚â–¼â–¼â–¼
QUESTIONS = [
    {
        "q": "è³ªå•1ï¼šæ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å§‹ã‚ã‚‹æ™‚ã€ã‚ãªãŸã®ã‚¹ã‚¿ã‚¤ãƒ«ã«æœ€ã‚‚è¿‘ã„ã®ã¯ï¼Ÿ",
        "a": {
            "a": "ã€Œã¾ãšã‚„ã£ã¦ã¿ã‚ˆã†ï¼ã€ã¨ã€ã™ãã«è¡Œå‹•ã‚’é–‹å§‹ã™ã‚‹ã€‚",
            "b": "æˆåŠŸã¾ã§ã®é“ã®ã‚Šã‚’è©³ç´°ã«è¨ˆç”»ã—ã€æº–å‚™ã‚’å›ºã‚ã¦ã‹ã‚‰å§‹ã‚ã‚‹ã€‚",
            "c": "å‘¨å›²ã®æ„è¦‹ã‚’èããªãŒã‚‰ã€æŸ”è»Ÿã«ã‚„ã‚Šæ–¹ã‚’å¤‰ãˆã¦ã„ãã€‚",
            "d": "ãªãœãã‚ŒãŒå¿…è¦ãªã®ã‹ã€ã¨ã„ã†ç†å¿µã‚„ç›®çš„ãŒæ˜ç¢ºã«ãªã‚‹ã¾ã§å‹•ã‹ãªã„ã€‚"
        },
        "map": {
            "a": {"type": "quality", "value": "æ´»å‹•", "target": "å…¨ä½“", "weight": 2, "trait": "ç‰©äº‹ã‚’ç‡å…ˆã—ã¦å§‹ã‚ã‚‹ä¸»å°æ€§"},
            "b": {"type": "quality", "value": "ä¸å‹•", "target": "å…¨ä½“", "weight": 2, "trait": "ä¸€åº¦æ±ºã‚ãŸã“ã¨ã‚’ç²˜ã‚Šå¼·ãç¶šã‘ã‚‹æŒç¶šåŠ›"},
            "c": {"type": "quality", "value": "æŸ”è»Ÿ", "target": "å…¨ä½“", "weight": 2, "trait": "çŠ¶æ³ã«å¿œã˜ã¦å¯¾å¿œã‚’å¤‰ãˆã‚‹é †å¿œæ€§"},
            "d": {"type": "emphasis", "value": "å¤ªé™½", "target": "å¤©ä½“", "weight": 1, "trait": "è¡Œå‹•ã®åŸºç›¤ã¨ãªã‚‹ç†å¿µã‚„ç›®çš„æ„è­˜"}
        }
    },
    {
        "q": "è³ªå•2ï¼šå¤§ããªå•é¡Œã«ç›´é¢ã—ãŸæ™‚ã€æœ€åˆã«ã¨ã‚‹è¡Œå‹•ã¯ï¼Ÿ",
        "a": {
            "a": "ä¿¡é ¼ã§ãã‚‹å‹äººæ•°äººã«ç›¸è«‡ã—ã€æ„è¦‹ã‚’æ±‚ã‚ã‚‹ã€‚",
            "b": "èª°ã«ã‚‚è©±ã•ãšã€ä¸€äººã§ã˜ã£ãã‚Šã¨è€ƒãˆã€è§£æ±ºç­–ã‚’æ¢ã™ã€‚",
            "c": "æ„Ÿæƒ…çš„ã«ãªã‚Šã€ã¾ãšã¯ãã®æ°—æŒã¡ã‚’èª°ã‹ã«èã„ã¦ã‚‚ã‚‰ã„ãŸããªã‚‹ã€‚",
            "d": "å•é¡Œã‹ã‚‰ä¸€æ—¦é›¢ã‚Œã€è¶£å‘³ã‚„åˆ¥ã®ä½œæ¥­ã«æ²¡é ­ã—ã¦æ°—åˆ†è»¢æ›ã™ã‚‹ã€‚"
        },
        "map": {
            "a": {"type": "element", "value": "é¢¨", "target": "æœˆ", "weight": 3, "trait": "å®¢è¦³çš„ãªæ„è¦‹ã‚’æ±‚ã‚ã‚‹ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³é‡è¦–ã®æ€§è³ª"},
            "b": {"type": "element", "value": "åœ°", "target": "æœˆ", "weight": 3, "trait": "ç¾å®Ÿçš„ãªè§£æ±ºç­–ã‚’æ±‚ã‚ã‚‹è‡ªå·±å®Œçµçš„ãªæ€§è³ª"},
            "c": {"type": "element", "value": "æ°´", "target": "æœˆ", "weight": 3, "trait": "æ„Ÿæƒ…ã®å…±æœ‰ã¨å…±æ„Ÿã‚’æ±‚ã‚ã‚‹æƒ…ç·’çš„ãªæ€§è³ª"},
            "d": {"type": "element", "value": "ç«", "target": "æœˆ", "weight": 3, "trait": "è¡Œå‹•ã‚’é€šã˜ã¦ã‚¹ãƒˆãƒ¬ã‚¹ã‚’è§£æ¶ˆã™ã‚‹ç›´æƒ…çš„ãªæ€§è³ª"}
        }
    },
        {
        "q": "è³ªå•3ï¼šç†æƒ³çš„ãªä¼‘æ—¥ã®éã”ã—æ–¹ã¯ï¼Ÿ",
        "a": {
            "a": "å¤§å‹¢ã®å‹äººã¨é›†ã¾ã‚Šã€è³‘ã‚„ã‹ã«ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ã‚„ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ¥½ã—ã‚€ã€‚",
            "b": "ã”ãè¦ªã—ã„å‹äººã‚„ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã¨ã€äºŒäººãã‚Šã§æ·±ã„èªã‚‰ã„ã‚’ã™ã‚‹ã€‚",
            "c": "ä¸€äººã§è¶£å‘³ã«æ²¡é ­ã—ãŸã‚Šã€å®¶ã§ã‚†ã£ãã‚Šã¨éã”ã—ãŸã‚Šã™ã‚‹ã€‚",
            "d": "æ–°ã—ã„å ´æ‰€ã¸å‡ºã‹ã‘ãŸã‚Šã€ã‚»ãƒŸãƒŠãƒ¼ã«å‚åŠ ã—ãŸã‚Šã—ã¦çŸ¥çš„ãªåˆºæ¿€ã‚’æ±‚ã‚ã‚‹ã€‚"
        },
        "map": {
            "a": {"type": "element", "value": "ç«", "target": "ASC", "weight": 2, "trait": "ã‚¨ãƒãƒ«ã‚®ãƒƒã‚·ãƒ¥ã§ç¤¾äº¤çš„ãªç¬¬ä¸€å°è±¡"},
            "b": {"type": "sign_emphasis", "value": "è åº§", "target": "ASC", "weight": 2, "trait": "æ·±ãé™å®šçš„ãªäººé–“é–¢ä¿‚ã‚’å¥½ã‚€æ€§è³ª"},
            "c": {"type": "element", "value": "åœ°", "target": "ASC", "weight": 2, "trait": "ç©ã‚„ã‹ã§è½ã¡ç€ã„ãŸç¬¬ä¸€å°è±¡"},
            "d": {"type": "sign_emphasis", "value": "å°„æ‰‹åº§", "target": "ASC", "weight": 2, "trait": "çŸ¥çš„å¥½å¥‡å¿ƒãŒæ—ºç››ã§è‡ªç”±ã‚’å¥½ã‚€æ€§è³ª"}
        }
    },
    {
        "q": "è³ªå•4ï¼šäººç”Ÿã®å¤§ããªæ±ºæ–­ã‚’ã™ã‚‹æ™‚ã€æœ€çµ‚çš„ãªæ±ºã‚æ‰‹ã¯ï¼Ÿ",
        "a": {
            "a": "è«–ç†çš„ãªãƒ¡ãƒªãƒƒãƒˆãƒ»ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã‚’æ¯”è¼ƒæ¤œè¨ã—ãŸä¸Šã§ã®çµè«–ã€‚",
            "b": "ã€Œãªã‚“ã¨ãªãã“ã¡ã‚‰ã®æ–¹ãŒè‰¯ã„æ°—ãŒã™ã‚‹ã€ã¨ã„ã†ç›´æ„Ÿã‚„ãƒ•ã‚£ãƒ¼ãƒªãƒ³ã‚°ã€‚",
            "c": "å°†æ¥ã®å®‰å®šã‚„çµŒæ¸ˆçš„ãªå®‰å¿ƒæ„ŸãŒå¾—ã‚‰ã‚Œã‚‹ã‹ã©ã†ã‹ã€‚",
            "d": "è‡ªåˆ†ã®ç†æƒ³ã‚„ã€Œã“ã†ã‚ã‚ŠãŸã„ã€ã¨ã„ã†å¤¢ã«è¿‘ã¥ã‘ã‚‹ã‹ã©ã†ã‹ã€‚"
        },
        "map": {
            "a": {"type": "emphasis", "value": "æ°´æ˜Ÿ", "target": "å¤©ä½“", "weight": 2, "trait": "è«–ç†ã¨æ€è€ƒã‚’é‡ã‚“ã˜ã‚‹æ€§è³ª"},
            "b": {"type": "emphasis", "value": "æœˆ", "target": "å¤©ä½“", "weight": 2, "trait": "æ„Ÿæƒ…ã‚„ç›´æ„Ÿã‚’ä¿¡é ¼ã™ã‚‹æ€§è³ª"},
            "c": {"type": "emphasis", "value": "åœŸæ˜Ÿ", "target": "å¤©ä½“", "weight": 2, "trait": "ç¾å®Ÿã¨å®‰å®šã‚’æœ€å„ªå…ˆã™ã‚‹æ€§è³ª"},
            "d": {"type": "emphasis", "value": "æµ·ç‹æ˜Ÿ", "target": "å¤©ä½“", "weight": 2, "trait": "å¤¢ã‚„ç†æƒ³ã‚’è¿½ã„æ±‚ã‚ã‚‹æ€§è³ª"}
        }
    },
    {
        "q": "è³ªå•5ï¼šã‚ãªãŸãŒæœ€ã‚‚ã€Œè¨±ã›ãªã„ã€ã¨æ„Ÿã˜ã‚‹ã“ã¨ã¯ï¼Ÿ",
        "a": {
            "a": "è£åˆ‡ã‚‰ã‚Œã‚‹ã“ã¨ã€ç§˜å¯†ã‚’è»½ã€…ã—ãæ‰±ã‚ã‚Œã‚‹ã“ã¨ã€‚",
            "b": "ä¸èª å®Ÿãªæ…‹åº¦ã€ãã®å ´ã—ã®ãã®å˜˜ã‚’ã¤ã‹ã‚Œã‚‹ã“ã¨ã€‚",
            "c": "å„ªæŸ”ä¸æ–­ãªæ…‹åº¦ã§ã€ç‰©äº‹ã‚’ãªã‹ãªã‹æ±ºã‚ãªã„ã“ã¨ã€‚",
            "d": "éåŠ¹ç‡ã§ã€ç„¡é§„ãŒå¤šã„ã‚„ã‚Šæ–¹ã‚’å¼·è¦ã•ã‚Œã‚‹ã“ã¨ã€‚"
        },
        "map": {
            "a": {"type": "sign_emphasis", "value": "è åº§", "target": "å¤ªé™½/æœˆ/ASC", "weight": 3, "trait": "æ·±ã„ä¿¡é ¼é–¢ä¿‚ã‚’è£åˆ‡ã‚‰ã‚Œã‚‹ã“ã¨ã¸ã®å¼·ã„åç™º"},
            "b": {"type": "sign_emphasis", "value": "å±±ç¾Šåº§", "target": "å¤ªé™½/æœˆ/ASC", "weight": 3, "trait": "èª å®Ÿã•ã¨è²¬ä»»æ„Ÿã‚’é‡ã‚“ã˜ã‚‹ä¾¡å€¤è¦³"},
            "c": {"type": "sign_emphasis", "value": "ç‰¡ç¾Šåº§", "target": "å¤ªé™½/æœˆ/ASC", "weight": 3, "trait": "è¿…é€Ÿãªæ±ºæ–­ã¨è¡Œå‹•ã‚’å°Šé‡ã™ã‚‹ä¾¡å€¤è¦³"},
            "d": {"type": "sign_emphasis", "value": "ä¹™å¥³åº§", "target": "å¤ªé™½/æœˆ/ASC", "weight": 3, "trait": "åŠ¹ç‡æ€§ã¨å®Œç’§ã•ã‚’æ±‚ã‚ã‚‹ä¾¡å€¤è¦³"}
        }
    },
    {
        "q": "è³ªå•6ï¼šä»–äººã¨ã®æ„è¦‹å¯¾ç«‹ãŒèµ·ããŸæ™‚ã€ã‚ãªãŸã®æ…‹åº¦ã¯ï¼Ÿ",
        "a": {
            "a": "è‡ªåˆ†ã®æ­£ã—ã•ã‚’ä¸»å¼µã—ã€ç›¸æ‰‹ã‚’èª¬å¾—ã—ã‚ˆã†ã¨è©¦ã¿ã‚‹ã€‚",
            "b": "ãã®å ´ã®èª¿å’Œã‚’å„ªå…ˆã—ã€è‡ªåˆ†ã®æ„è¦‹ã‚’ä¸€æ—¦æŠ‘ãˆã‚‹ã€‚",
            "c": "å†·é™ã«è­°è«–ã—ã€ãŠäº’ã„ã®å¦¥å”ç‚¹ã‚’æ¢ã‚‹ã€‚",
            "d": "æ„Ÿæƒ…çš„ã«ãªã‚Šã€ãã®å ´ã‹ã‚‰é›¢ã‚ŒãŸããªã‚‹ã€‚"
        },
        "map": {
            "a": {"type": "element", "value": "ç«", "target": "ç«æ˜Ÿ", "weight": 2, "trait": "è‡ªå·±ä¸»å¼µãŒå¼·ãã€é—˜äº‰ã‚’æã‚Œãªã„æ€§è³ª"},
            "b": {"type": "sign_emphasis", "value": "å¤©ç§¤åº§", "target": "ç«æ˜Ÿ", "weight": 2, "trait": "å¯¾ç«‹ã‚’é¿ã‘ã€èª¿å’Œçš„ãªè§£æ±ºã‚’æœ›ã‚€æ€§è³ª"},
            "c": {"type": "element", "value": "é¢¨", "target": "ç«æ˜Ÿ", "weight": 2, "trait": "è¨€è‘‰ã«ã‚ˆã‚‹è«–ç†çš„ãªè­°è«–ã§è§£æ±ºã—ã‚ˆã†ã¨ã™ã‚‹æ€§è³ª"},
            "d": {"type": "element", "value": "æ°´", "target": "ç«æ˜Ÿ", "weight": 2, "trait": "å¯¾ç«‹ã«ãŠã„ã¦æ„Ÿæƒ…ãŒå„ªå…ˆã•ã‚Œã‚‹ç¹Šç´°ãªæ€§è³ª"}
        }
    },
    {
        "q": "è³ªå•7ï¼šã‚ãªãŸã«ã¨ã£ã¦ã€Œç¾ã—ã•ã€ã¨ã¯ï¼Ÿ",
        "a": {
            "a": "æ©Ÿèƒ½çš„ã§æ´—ç·´ã•ã‚ŒãŸã€ç„¡é§„ã®ãªã„ãƒ‡ã‚¶ã‚¤ãƒ³ã€‚",
            "b": "è‡ªç„¶ã®ç´ æã‚„ã€æ‰‹ä»•äº‹ã®æ¸©ã‹ã¿ãŒæ„Ÿã˜ã‚‰ã‚Œã‚‹ã‚‚ã®ã€‚",
            "c": "è¯ã‚„ã‹ã§ã€äººã®å¿ƒã‚’é«˜æšã•ã›ã‚‹ãƒ‰ãƒ©ãƒãƒ†ã‚£ãƒƒã‚¯ãªã‚‚ã®ã€‚",
            "d": "å„šã•ã‚„ã€ä¸å®Œå…¨ã•ã®ä¸­ã«å®¿ã‚‹è¶£ã€‚"
        },
        "map": {
            "a": {"type": "sign_emphasis", "value": "ä¹™å¥³åº§", "target": "é‡‘æ˜Ÿ", "weight": 2, "trait": "å®Œç’§ã§æ©Ÿèƒ½çš„ãªç¾ã‚’å¥½ã‚€æ„Ÿæ€§"},
            "b": {"type": "sign_emphasis", "value": "ç‰¡ç‰›åº§", "target": "é‡‘æ˜Ÿ", "weight": 2, "trait": "äº”æ„Ÿã«å¿ƒåœ°ã‚ˆã„è‡ªç„¶ãªç¾ã‚’å¥½ã‚€æ„Ÿæ€§"},
            "c": {"type": "sign_emphasis", "value": "ç…å­åº§", "target": "é‡‘æ˜Ÿ", "weight": 2, "trait": "ãƒ‰ãƒ©ãƒãƒ†ã‚£ãƒƒã‚¯ã§è‡ªå·±è¡¨ç¾è±Šã‹ãªç¾ã‚’å¥½ã‚€æ„Ÿæ€§"},
            "d": {"type": "sign_emphasis", "value": "é­šåº§", "target": "é‡‘æ˜Ÿ", "weight": 2, "trait": "å¹»æƒ³çš„ã§æƒ…ç·’çš„ãªç¾ã‚’å¥½ã‚€æ„Ÿæ€§"}
        }
    },
    {
        "q": "è³ªå•8ï¼šä»•äº‹ã«ãŠã„ã¦ã€æœ€ã‚‚ã‚„ã‚ŠãŒã„ã‚’æ„Ÿã˜ã‚‹ç¬é–“ã¯ï¼Ÿ",
        "a": {
            "a": "ãƒãƒ¼ãƒ ã§ä¸€ä½“ã¨ãªã‚Šã€å¤§ããªç›®æ¨™ã‚’é”æˆã—ãŸæ™‚ã€‚",
            "b": "è‡ªåˆ†ã®å°‚é–€ã‚¹ã‚­ãƒ«ã‚„çŸ¥è­˜ã‚’æ·±ã‚ã€å®Œç’§ãªä»•äº‹ãŒã§ããŸæ™‚ã€‚",
            "c": "èª°ã‹ã®å½¹ã«ç«‹ã£ã¦ã„ã‚‹ã€ç¤¾ä¼šã«è²¢çŒ®ã—ã¦ã„ã‚‹ã¨å®Ÿæ„Ÿã—ãŸæ™‚ã€‚",
            "d": "é«˜ã„è©•ä¾¡ã‚’å¾—ã¦ã€è‡ªåˆ†ã®åœ°ä½ã‚„åå…¥ãŒä¸ŠãŒã£ãŸæ™‚ã€‚"
        },
        "map": {
            "a": {"type": "house_emphasis", "value": 11, "target": "MC", "weight": 2, "trait": "ä»²é–“ã¨ã®é€£å¸¯æ„Ÿã‚’é‡è¦–ã™ã‚‹ä¾¡å€¤è¦³"},
            "b": {"type": "sign_emphasis", "value": "ä¹™å¥³åº§", "target": "MC", "weight": 2, "trait": "å°‚é–€æ€§ã‚’æ¥µã‚ã‚‹è·äººæ°—è³ªã®ä¾¡å€¤è¦³"},
            "c": {"type": "sign_emphasis", "value": "é­šåº§", "target": "MC", "weight": 2, "trait": "å¥‰ä»•ã¨è²¢çŒ®ã‚’é‡è¦–ã™ã‚‹ä¾¡å€¤è¦³"},
            "d": {"type": "sign_emphasis", "value": "å±±ç¾Šåº§", "target": "MC", "weight": 2, "trait": "ç¤¾ä¼šçš„ãªæˆåŠŸã¨è©•ä¾¡ã‚’é‡è¦–ã™ã‚‹ä¾¡å€¤è¦³"}
        }
    },
    {
        "q": "è³ªå•9ï¼šã‚ãªãŸã®äººç”Ÿè¦³ã«æœ€ã‚‚è¿‘ã„è€ƒãˆæ–¹ã¯ï¼Ÿ",
        "a": {
            "a": "äººç”Ÿã¯ä¸€åº¦ãã‚Šã€‚å¸¸ã«æ–°ã—ã„ã“ã¨ã«æŒ‘æˆ¦ã—ã€è‡ªåˆ†ã‚’æˆé•·ã•ã›ãŸã„ã€‚",
            "b": "é‹å‘½ã‚„è¦‹ãˆãªã„åŠ›ã¯å­˜åœ¨ã™ã‚‹ã€‚æµã‚Œã«èº«ã‚’ä»»ã›ã‚‹ã“ã¨ã‚‚å¤§åˆ‡ã ã€‚",
            "c": "åŠªåŠ›ã¯å¿…ãšå ±ã‚ã‚Œã‚‹ã€‚åœ°é“ãªç©ã¿é‡ã­ãŒç¢ºã‹ãªæœªæ¥ã‚’å‰µã‚‹ã€‚",
            "d": "äººç”Ÿã¯æ¥½ã—ã‚€ãŸã‚ã«ã‚ã‚‹ã€‚ãƒ¦ãƒ¼ãƒ¢ã‚¢ã¨æ¥½è¦³æ€§ã‚’å¿˜ã‚ŒãŸããªã„ã€‚"
        },
        "map": {
            "a": {"type": "emphasis", "value": "æœ¨æ˜Ÿ", "target": "å¤©ä½“", "weight": 2, "trait": "è‡ªå·±æˆé•·ã¨æŒ‘æˆ¦ã‚’æ±‚ã‚ã‚‹äººç”Ÿè¦³"},
            "b": {"type": "emphasis", "value": "æµ·ç‹æ˜Ÿ", "target": "å¤©ä½“", "weight": 2, "trait": "é‹å‘½ã‚„ç²¾ç¥æ€§ã‚’é‡ã‚“ã˜ã‚‹äººç”Ÿè¦³"},
            "c": {"type": "emphasis", "value": "åœŸæ˜Ÿ", "target": "å¤©ä½“", "weight": 2, "trait": "åŠªåŠ›ã¨ç¾å®Ÿã‚’é‡ã‚“ã˜ã‚‹äººç”Ÿè¦³"},
            "d": {"type": "sign_emphasis", "value": "å°„æ‰‹åº§", "target": "å…¨ä½“", "weight": 2, "trait": "æ¥½è¦³æ€§ã¨è‡ªç”±ã‚’æ±‚ã‚ã‚‹äººç”Ÿè¦³"}
        }
    },
    {
        "q": "è³ªå•10ï¼šå¤§ããªå¤±æ•—ã‚’ã—ãŸæ™‚ã€ã©ã†ä¹—ã‚Šè¶Šãˆã¾ã™ã‹ï¼Ÿ",
        "a": {
            "a": "è‡ªåˆ†ã®åŠ›ä¸è¶³ã‚’ç—›æ„Ÿã—ã€åŸå› ã‚’å¾¹åº•çš„ã«åˆ†æã—ã¦æ¬¡ã«æ´»ã‹ã™ã€‚",
            "b": "ä¿¡é ¼ã§ãã‚‹äººã«è©±ã‚’èã„ã¦ã‚‚ã‚‰ã„ã€åŠ±ã¾ã—ã¦ã‚‚ã‚‰ã†ã“ã¨ã§ç«‹ã¡ç›´ã‚‹ã€‚",
            "c": "ã€Œã“ã‚Œã‚‚çµŒé¨“ã ã€ã¨æ°—æŒã¡ã‚’åˆ‡ã‚Šæ›¿ãˆã€ã‚ã¾ã‚Šå¼•ããšã‚‰ãªã„ã€‚",
            "d": "ã—ã°ã‚‰ãè½ã¡è¾¼ã‚€ãŒã€æ™‚é–“ãŒçµŒã¦ã°è‡ªç„¶ã¨å¿˜ã‚Œã¦ã„ãã€‚"
        },
        "map": {
            "a": {"type": "emphasis", "value": "åœŸæ˜Ÿ", "target": "å¤©ä½“", "weight": 2, "trait": "å¤±æ•—ã‚’åˆ†æã—ã€æ•™è¨“ã‚’å¾—ã‚ˆã†ã¨ã™ã‚‹å›å¾©ã‚¹ã‚¿ã‚¤ãƒ«"},
            "b": {"type": "emphasis", "value": "æœˆ", "target": "å¤©ä½“", "weight": 2, "trait": "ä»–è€…ã¨ã®å…±æ„Ÿã‚’é€šã˜ã¦å›å¾©ã™ã‚‹ã‚¹ã‚¿ã‚¤ãƒ«"},
            "c": {"type": "emphasis", "value": "æœ¨æ˜Ÿ", "target": "å¤©ä½“", "weight": 2, "trait": "æ¥½è¦³çš„ã«æ°—æŒã¡ã‚’åˆ‡ã‚Šæ›¿ãˆã¦å›å¾©ã™ã‚‹ã‚¹ã‚¿ã‚¤ãƒ«"},
            "d": {"type": "quality", "value": "æŸ”è»Ÿ", "target": "å…¨ä½“", "weight": 2, "trait": "çŠ¶æ³ã‚’å—ã‘å…¥ã‚Œã€è‡ªç„¶ã«ç«‹ã¡ç›´ã£ã¦ã„ãå›å¾©ã‚¹ã‚¿ã‚¤ãƒ«"}
        }
    },
    {
        "q": "è³ªå•11ï¼šã‚ãªãŸã®ä½“å‹ã‚„ç¬¬ä¸€å°è±¡ã«ã¤ã„ã¦ã€äººã‹ã‚‰ã‚ˆãè¨€ã‚ã‚Œã‚‹ã“ã¨ã«æœ€ã‚‚è¿‘ã„ã‚‚ã®ã¯ï¼Ÿ",
        "a": {
            "a": "ã‚¹ãƒ©ãƒªã¨ã—ã¦ä¸­æ€§çš„ã€ã‚·ãƒ£ãƒ¼ãƒ—ãªå°è±¡",
            "b": "ãŒã£ã—ã‚Šã—ã¦ã„ã¦ã€è½ã¡ç€ã„ãŸå°è±¡",
            "c": "ãµã£ãã‚‰ã¨ã—ã¦ã€å„ªã—ãè¦ªã—ã¿ã‚„ã™ã„å°è±¡",
            "d": "ç­‹è‚‰è³ªã§ã€ã‚¨ãƒãƒ«ã‚®ãƒƒã‚·ãƒ¥ãªå°è±¡"
        },
        "map": {
            "a": {"type": "multi_sign_emphasis", "value": ["åŒå­åº§", "ä¹™å¥³åº§", "æ°´ç“¶åº§"], "target": "ASC", "weight": 3, "trait": "çŸ¥çš„ã§ã‚·ãƒ£ãƒ¼ãƒ—ãªç¬¬ä¸€å°è±¡"},
            "b": {"type": "multi_sign_emphasis", "value": ["ç‰¡ç‰›åº§", "å±±ç¾Šåº§"], "target": "ASC", "weight": 3, "trait": "è½ã¡ç€ãã¨å®‰å®šæ„Ÿã®ã‚ã‚‹ç¬¬ä¸€å°è±¡"},
            "c": {"type": "multi_sign_emphasis", "value": ["èŸ¹åº§", "é­šåº§"], "target": "ASC", "weight": 3, "trait": "å„ªã—ãè¦ªã—ã¿ã‚„ã™ã„ç¬¬ä¸€å°è±¡"},
            "d": {"type": "multi_sign_emphasis", "value": ["ç‰¡ç¾Šåº§", "ç…å­åº§"], "target": "ASC", "weight": 3, "trait": "æ´»ç™ºã§ã‚¨ãƒãƒ«ã‚®ãƒƒã‚·ãƒ¥ãªç¬¬ä¸€å°è±¡"}
        }
    }
]

# --- å æ˜Ÿè¡“è¨ˆç®—é–¢æ•° ---

def get_jd(dt_obj):
    dt_utc = dt_obj.replace(tzinfo=timezone(timedelta(hours=9))).astimezone(timezone.utc)
    return swe.utc_to_jd(dt_utc.year, dt_utc.month, dt_utc.day, dt_utc.hour, dt_utc.minute, dt_utc.second, 1)[1]

def get_sign(degree):
    return SIGN_NAMES[int(degree / 30)]

def calculate_chart(jd, lat, lon):
    chart = {'planets': {}, 'angles': {}, 'elements': {'ç«': 0, 'åœ°': 0, 'é¢¨': 0, 'æ°´': 0}, 'qualities': {'æ´»å‹•': 0, 'ä¸å‹•': 0, 'æŸ”è»Ÿ': 0}}
    iflag = swe.FLG_SWIEPH
    for name, pid in PLANET_IDS.items():
        pos = swe.calc_ut(jd, pid, iflag)[0][0]
        sign = get_sign(pos)
        chart['planets'][name] = sign
        for el, signs in ELEMENTS.items():
            if sign in signs: chart['elements'][el] += 1
        for q, signs in QUALITIES.items():
            if sign in signs: chart['qualities'][q] += 1
    cusps, ascmc = swe.houses(jd, lat, lon, b'P')
    chart['angles']['ASC'] = get_sign(ascmc[0])
    chart['angles']['MC'] = get_sign(ascmc[1])
    return chart

# â–¼â–¼â–¼ å¤‰æ›´ç‚¹2ï¼šæ ¹æ‹ ã‚’è©³ç´°ã«ç”Ÿæˆã™ã‚‹ã‚ˆã†score_charté–¢æ•°ã‚’å…¨é¢çš„ã«æ”¹ä¿® â–¼â–¼â–¼
def score_chart(chart, answers):
    score = 0
    reasons = []

    for i, ans_key in enumerate(answers):
        if not ans_key: continue
        
        q_map = QUESTIONS[i]["map"][ans_key]
        map_type = q_map["type"]
        map_value = q_map["value"]
        map_target = q_map["target"]
        map_weight = q_map["weight"]
        trait_desc = q_map["trait"]

        reason_text = ""
        is_match = False

        # --- ãƒãƒƒãƒãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯ã¨æ ¹æ‹ ç”Ÿæˆ ---
        if map_type == "quality":
            if chart['qualities'][map_value] >= 4:
                is_match = True
                reason_text = f"ã‚ãªãŸã®ã€Œ{trait_desc}ã€ã¨ã„ã†å›ç­”ã¯ã€ç‰©äº‹ã¸ã®å–ã‚Šçµ„ã¿æ–¹ã«ãŠã‘ã‚‹**{map_value}å®®**ã®æ€§è³ªã‚’å¼·ãç¤ºå”†ã—ã¾ã™ã€‚ã“ã®æ™‚é–“å¸¯ã®ãƒ›ãƒ­ã‚¹ã‚³ãƒ¼ãƒ—ã§ã¯ã€å¤©ä½“ã®å¤šããŒ{map_value}å®®ã«é›†ä¸­ã—ã¦ãŠã‚Šã€ã‚ãªãŸã®æ€§æ ¼ã¨ä¸€è‡´ã—ã¾ã™ã€‚"
        
        elif map_type == "element":
            target_planet_sign = chart['planets'].get(map_target) or chart['angles'].get(map_target)
            if target_planet_sign and target_planet_sign in ELEMENTS[map_value]:
                is_match = True
                if map_target == "æœˆ":
                    reason_text = f"ã‚ãªãŸã®ã€Œ{trait_desc}ã€ã¨ã„ã†å›ç­”ã¯ã€æ„Ÿæƒ…ã®æ ¸ã§ã‚ã‚‹**æœˆ**ã®æ€§è³ªã‚’åæ˜ ã—ã¾ã™ã€‚ã“ã®æ™‚é–“å¸¯ã®æœˆã¯**{map_value}ã®ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆ**ã«å±ã™ã‚‹**{target_planet_sign}**ã«ã‚ã‚Šã€ã‚ãªãŸã®æƒ…ç·’çš„ãªç‰¹å¾´ã¨å¼·ãçµã³ã¤ãã¾ã™ã€‚"
                else: #ç«æ˜Ÿã‚„ASCãªã©
                    reason_text = f"ã‚ãªãŸã®ã€Œ{trait_desc}ã€ã¨ã„ã†å›ç­”ã¯ã€**{map_target}**ãŒè±¡å¾´ã™ã‚‹æ€§è³ªã¨é–¢é€£ã—ã¾ã™ã€‚ã“ã®æ™‚é–“å¸¯ã®{map_target}ã¯**{map_value}ã®ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆ**ã«å±ã™ã‚‹**{target_planet_sign}**ã«ã‚ã‚Šã€ã‚ãªãŸã®è¡Œå‹•æ§˜å¼ã¨ä¸€è‡´ã—ã¾ã™ã€‚"

        elif map_type == "sign_emphasis" or map_type == "multi_sign_emphasis":
            target_signs = map_value if isinstance(map_value, list) else [map_value]
            # ã‚¿ãƒ¼ã‚²ãƒƒãƒˆï¼ˆå¤ªé™½ã€æœˆã€ASCãªã©ï¼‰ã‚’ãƒã‚§ãƒƒã‚¯
            matched_targets = []
            if "å¤ªé™½" in map_target and chart['planets']['å¤ªé™½'] in target_signs: matched_targets.append(f"å¤ªé™½ãŒ{chart['planets']['å¤ªé™½']}ã«ã‚ã‚‹ã“ã¨")
            if "æœˆ" in map_target and chart['planets']['æœˆ'] in target_signs: matched_targets.append(f"æœˆãŒ{chart['planets']['æœˆ']}ã«ã‚ã‚‹ã“ã¨")
            if "ASC" in map_target and chart['angles']['ASC'] in target_signs: matched_targets.append(f"ã‚¢ã‚»ãƒ³ãƒ€ãƒ³ãƒˆãŒ{chart['angles']['ASC']}ã«ã‚ã‚‹ã“ã¨")
            if "MC" in map_target and chart['angles']['MC'] in target_signs: matched_targets.append(f"MCãŒ{chart['angles']['MC']}ã«ã‚ã‚‹ã“ã¨")
            if "é‡‘æ˜Ÿ" in map_target and chart['planets']['é‡‘æ˜Ÿ'] in target_signs: matched_targets.append(f"é‡‘æ˜ŸãŒ{chart['planets']['é‡‘æ˜Ÿ']}ã«ã‚ã‚‹ã“ã¨")
            if "ç«æ˜Ÿ" in map_target and chart['planets']['ç«æ˜Ÿ'] in target_signs: matched_targets.append(f"ç«æ˜ŸãŒ{chart['planets']['ç«æ˜Ÿ']}ã«ã‚ã‚‹ã“ã¨")
            if "å…¨ä½“" in map_target and (chart['angles']['ASC'] in target_signs or chart['planets']['å¤ªé™½'] in target_signs): matched_targets.append(f"å¤ªé™½ã¾ãŸã¯ã‚¢ã‚»ãƒ³ãƒ€ãƒ³ãƒˆãŒ{'/'.join(target_signs)}ã«ã‚ã‚‹ã“ã¨")
            
            if matched_targets:
                is_match = True
                reason_text = f"ã‚ãªãŸã®ã€Œ{trait_desc}ã€ã¨ã„ã†å›ç­”ã¯ã€**{'/'.join(target_signs)}**ã®ä¾¡å€¤è¦³ã‚’å¼·ãåæ˜ ã—ã¦ã„ã¾ã™ã€‚ã“ã®æ™‚é–“å¸¯ã®ãƒ›ãƒ­ã‚¹ã‚³ãƒ¼ãƒ—ã§ã¯ã€{'ã€'.join(matched_targets)}ãŒã€ãã®æ€§è³ªã‚’è£ä»˜ã‘ã¦ã„ã¾ã™ã€‚"
        
        elif map_type == "emphasis" or map_type == "house_emphasis":
             # ç°¡ç•¥åŒ–ãƒ­ã‚¸ãƒƒã‚¯ï¼šã“ã“ã§ã¯ç‰¹å®šã®å¤©ä½“ãƒ»ãƒ†ãƒ¼ãƒã®é‡è¦æ€§ã‚’ç¤ºã™æ ¹æ‹ ã¨ã—ã¦è¨˜è¿°
             is_match = True # ã“ã®ã‚¿ã‚¤ãƒ—ã¯å¸¸ã«åŠ ç‚¹
             reason_text = f"ã‚ãªãŸã®ã€Œ{trait_desc}ã€ã¨ã„ã†å›ç­”ã¯ã€å æ˜Ÿè¡“ã§**ã€Œ{map_value}ã€**ãŒè±¡å¾´ã™ã‚‹ãƒ†ãƒ¼ãƒãŒã€ã‚ãªãŸã®äººç”Ÿã§é‡è¦ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºå”†ã—ã¦ã„ã¾ã™ã€‚ã“ã®æ™‚é–“å¸¯ã®ãƒ›ãƒ­ã‚¹ã‚³ãƒ¼ãƒ—ã¯ã€ãã®ãƒ†ãƒ¼ãƒã‚’å¼·èª¿ã™ã‚‹é…ç½®ã‚’æŒã£ã¦ã„ã¾ã™ã€‚"


        if is_match:
            score += map_weight
            reasons.append(reason_text)
            
    return score, reasons

# --- Streamlit UI ---

st.set_page_config(page_title="å¿ƒç†å æ˜Ÿè¡“ãƒ¬ã‚¯ãƒ†ã‚£ãƒ•ã‚£ã‚±ãƒ¼ã‚·ãƒ§ãƒ³", page_icon="ğŸ”®")
st.title("ğŸ”® å¿ƒç†å æ˜Ÿè¡“ãƒ¬ã‚¯ãƒ†ã‚£ãƒ•ã‚£ã‚±ãƒ¼ã‚·ãƒ§ãƒ³")
st.write("11ã®è³ªå•ã«ç­”ãˆã‚‹ã“ã¨ã§ã€ã‚ãªãŸã®æ€§æ ¼ã‹ã‚‰æœ€ã‚‚å¯èƒ½æ€§ã®é«˜ã„å‡ºç”Ÿæ™‚åˆ»ã‚’æ¨å®šã—ã¾ã™ã€‚")

st.header("1. åŸºæœ¬æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„")
col1, col2 = st.columns(2)
birth_date = col1.date_input("ğŸ“… ç”Ÿå¹´æœˆæ—¥", min_value=datetime(1900, 1, 1), max_value=datetime(2099, 12, 31), value=datetime(1990, 1, 1))
birth_pref = col2.selectbox("ğŸ“ å‡ºç”Ÿéƒ½é“åºœçœŒ", options=list(PREFECTURE_DATA.keys()), index=12)

st.header("2. å¿ƒç†ãƒ†ã‚¹ãƒˆ")
st.info("æ·±ãè€ƒãˆãšã€ç›´æ„Ÿçš„ã«ãŠç­”ãˆãã ã•ã„ã€‚")

answers = []
for i, q_data in enumerate(QUESTIONS):
    st.subheader(q_data["q"])
    ans = st.radio("é¸æŠè‚¢:", list(q_data["a"].values()), key=f"q{i}", index=None, horizontal=True)
    ans_key = next((key for key, value in q_data["a"].items() if value == ans), None)
    answers.append(ans_key)

st.markdown("---")

if st.button("é‘‘å®šã™ã‚‹ ğŸš€", type="primary"):
    if None in answers:
        st.warning("ã™ã¹ã¦ã®è³ªå•ã«å›ç­”ã—ã¦ãã ã•ã„ã€‚")
    else:
        if not os.path.exists(EPHE_PATH):
            st.error(f"å¤©ä½“æš¦ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚`{EPHE_PATH}` ãƒ•ã‚©ãƒ«ãƒ€ã‚’é…ç½®ã—ã¦ãã ã•ã„ã€‚")
            st.stop()
        swe.set_ephe_path(EPHE_PATH)

        coords = PREFECTURE_DATA[birth_pref]
        lat, lon = coords["lat"], coords["lon"]
        
        candidate_times = []
        
        progress_text = "å‡ºç”Ÿæ™‚åˆ»ã®å€™è£œã‚’æ¤œè¨¼ä¸­... (00:00)"
        bar = st.progress(0, text=progress_text)

        total_steps = 24 * 4
        for i, minute_of_day in enumerate(range(0, 24 * 60, 15)):
            hour = minute_of_day // 60
            minute = minute_of_day % 60
            candidate_time = time(hour, minute)
            bar.progress((i + 1) / total_steps, text=f"å‡ºç”Ÿæ™‚åˆ»ã®å€™è£œã‚’æ¤œè¨¼ä¸­... ({candidate_time.strftime('%H:%M')})")
            birth_dt = datetime.combine(birth_date, candidate_time)
            jd = get_jd(birth_dt)
            chart = calculate_chart(jd, lat, lon)
            score, reasons = score_chart(chart, answers)
            if score > 0:
                candidate_times.append({"time": candidate_time, "score": score, "reasons": reasons})

        bar.empty()

        st.header("é‘‘å®šçµæœ")
        if not candidate_times:
            st.warning("å›ç­”ã«ä¸€è‡´ã™ã‚‹æœ‰åŠ›ãªå‡ºç”Ÿæ™‚åˆ»ã®å€™è£œã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚")
        else:
            sorted_candidates = sorted(candidate_times, key=lambda x: x['score'], reverse=True)
            max_score = sorted_candidates[0]['score'] if sorted_candidates else 1
            
            st.success(f"ã‚ãªãŸã®æ€§æ ¼ã«æœ€ã‚‚ä¸€è‡´ã™ã‚‹å¯èƒ½æ€§ã®é«˜ã„å‡ºç”Ÿæ™‚åˆ»ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚")

            for i, candidate in enumerate(sorted_candidates[:5]):
                percentage = (candidate['score'] / max_score * 100)
                
                with st.container(border=True):
                    st.subheader(f"ç¬¬ {i+1} ä½ï¼š **{candidate['time'].strftime('%H:%M')} ã”ã‚**")
                    st.progress(int(percentage), text=f"å¯èƒ½æ€§: {percentage:.0f}%")
                    st.markdown("**â–¼ è¥¿æ´‹å æ˜Ÿè¡“ã®è¦³ç‚¹ã‹ã‚‰ã®æ ¹æ‹ **")
                    unique_reasons = sorted(list(set(candidate['reasons'])))
                    for reason in unique_reasons:
                        st.markdown(f"- {reason}")
